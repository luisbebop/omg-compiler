<!DOCTYPE html>
<html lang="en">
	<head>
		<title>omg-compiler</title>
		<style type="text/css" media="screen">
		    #editor { 
		        position: absolute;
		        top: 0;
		        right: 0;
		        bottom: 0;
		        left: 0;
		    }
		
			#output {
				position: absolute;
				top: 1;
				right: 0;
				bottom: 0;
				left: 1;
			}
		</style>
	</head>
	
	<body>	
		<div id="editor"></div>
		<div id="output">
			<textarea id="txtArea" rows="10" cols="70"></textarea>
			<input type="button" value="Compile" onClick="CompileOnServer();" />
		</div>
			
		<script src="http://rawgithub.com/ajaxorg/ace-builds/master/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
		
		<script>
			//setting ace editor
		    var editor = ace.edit("editor");
		    editor.setTheme("ace/theme/twilight");
		    editor.getSession().setMode("ace/mode/xml");
			editor.getSession().setValue("<display line=\"0\" column=\"0\" message=\"hello world\"/>");
		
			//setting web socket and code struct
			var codeS = {Type: "posxml", Code: "", Output: ""};
			var ws;
			
			//open a new websocket
			ws = new WebSocket("ws://192.168.1.4/compile");
				
			//callback when websocket connects
			ws.onopen = function() {
				console.log("ws.onopen()");
			};
			
			//callback when websocket is closed
			ws.onclose = function (e) {
  				console.log("ws.onclose()")
			};
				
			//callback when websocket receive a message from the server
			ws.onmessage = function(e) {
				console.log("ws.onmessage()");
				codeS = JSON.parse(e.data);
				document.getElementById("txtArea").value = codeS.Output;
			};
			
			//get the code on ace and send to websocket
			function CompileOnServer() {
				codeS.Code = editor.getSession().getValue();
				m = JSON.stringify(codeS);
				document.getElementById("txtArea").value = "compiling ...";
				ws.send(m);
			};
		</script>
	</body>
</html>